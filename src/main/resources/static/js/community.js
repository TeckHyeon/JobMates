document.addEventListener("DOMContentLoaded", function() {
    function loadContent(sortType, target) {
        fetch(`/community/data?sort=${sortType}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                let content = '';
                data.forEach(item => {
                    content += `
                        <li class="list-group-item list-group-item-action py-3">
                            <div class="container">
                                <p class="fs-5 container" id="communityTitle">${item.communityTitle}</p>
                                <div class="fs-6 text-truncate-2 container" id="communityContent">${item.communityContent}</div>
                                <div class="container d-flex my-2">
                                    <div>
                                        <span>
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye" viewBox="0 0 16 16">
                                                <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z"/>
                                                <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0"/>
                                            </svg>
                                        </span>
                                        <span>${item.viewCount}</span>
                                    </div>
                                    <span class="vr ms-3 align-self-center" style="height: 50%"></span>
                                    <div class="ms-3">
                                        <span>
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-hand-thumbs-up" viewBox="0 0 16 16">
                                                <path d="M8.864.046C7.908-.193 7.02.53 6.956 1.466c-.072 1.051-.23 2.016-.428 2.59-.125.36-.479 1.013-1.04 1.639-.557.623-1.282 1.178-2.131 1.41C2.685 7.288 2 7.87 2 8.72v4.001c0 .845.682 1.464 1.448 1.545 1.07.114 1.564.415 2.068.723l.048.03c.272.165.578.348.97.484.397.136.861.217 1.466.217h3.5c.937 0 1.599-.477 1.934-1.064a1.86 1.86 0 0 0 .254-.912c0-.152-.023-.312-.077-.464.201-.263.38-.578.488-.901.11-.33.172-.762.004-1.149.069-.13.12-.269.159-.403.077-.27.113-.568.113-.857 0-.288-.036-.585-.113-.856a2 2 0 0 0-.138-.362 1.9 1.9 0 0 0 .234-1.734c-.206-.592-.682-1.1-1.2-1.272-.847-.282-1.803-.276-2.516-.211a10 10 0 0 0-.443.05 9.4 9.4 0 0 0-.062-4.509A1.38 1.38 0 0 0 9.125.111zM11.5 14.721H8c-.51 0-.863-.069-1.14-.164-.281-.097-.506-.228-.776-.393l-.04-.024c-.555-.339-1.198-.731-2.49-.868-.333-.036-.554-.29-.554-.55V8.72c0-.254.226-.543.62-.65 1.095-.3 1.977-.996 2.614-1.708.635-.71 1.064-1.475 1.168-1.64.282-.5.428-1.223.482-2.357.027-.587.445-.863.885-.953.525-.104 1.002.163 1.066.517.178.992.22 2.248-.004 3.379-.15.75-.509 1.4-.871 1.97-.135.214-.289.414-.452.611-.222.26-.27.647-.155.972.098.272.29.507.495.776.384.513.874.972 1.446 1.186.777.28 1.527.226 2.09.064.24-.071.443-.145.582-.236a.866.866 0 0 0 .415-.503.834.834 0 0 0-.056-.417 1.6 1.6 0 0 0-.493-.75.538.538 0 0 0-.45-.172.595.595 0 0 0-.344.148 1.284 1.284 0 0 0-.302.321.747.747 0 0 0-.073.506c.017.095.052.18.088.257.063.13.145.234.203.349.14.268.216.544.216.833a1.356 1.356 0 0 1-.19.681.678.678 0 0 1-.373.251c-.304.083-.642.099-.93-.065z"/>
                                            </svg>
                                        </span>
                                        <span>${item.likeCount}</span>
                                    </div>
                                    <span class="vr ms-3 align-self-center" style="height: 50%"></span>
                                    <div class="ms-3">
                                        <span>
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat-dots" viewBox="0 0 16 16">
                                                <path d="M4.904 1.697C6.142.676 7.905.5 9.6.5h1.12c2.687 0 5 2.142 5 5s-2.313 5-5 5H5.5a4.478 4.478 0 0 1-.94-.113L3 11.4V9.01a5.005 5.005 0 0 1 1.904-7.313zm3.845 8.18A4.496 4.496 0 0 1 5.5 9H5.457a.5.5 0 0 0-.39.181l-.835.958a.5.5 0 0 0 .059.7l1.52 1.3a.5.5 0 0 0 .572.05A4.5 4.5 0 0 1 9.5 11.5H10.6c1.394 0 2.75-.658 3.5-1.697V4.5c0-1.502-1.507-3-3-3h-1.12C8.02 1.5 6.58 1.72 5.65 2.562a3.981 3.981 0 0 0-1.646 4.604l.387.78a.5.5 0 0 0 .518.252H7.1a.5.5 0 0 1 .49.618 3.983 3.983 0 0 0 5.285 4.207A4.5 4.5 0 0 1 9.5 11.5zm-1.2-2.165c.683 0 1.316-.16 1.857-.442a4.48 4.48 0 0 0 1.266-1.027c.195-.235.293-.49.293-.729a.5.5 0 0 0-.451-.452.516.516 0 0 0-.451.293c-.07.169-.158.317-.268.454a2.481 2.481 0 0 1-1.571.742c-.28 0-.544-.059-.78-.17a.5.5 0 0 0-.657.279l-.387.78a3.98 3.98 0 0 0-.294.645.5.5 0 0 0 .232.619z"/>
                                                <path d="M9.5 11.5H10.6c1.394 0 2.75-.658 3.5-1.697V4.5c0-1.502-1.507-3-3-3h-1.12C8.02 1.5 6.58 1.72 5.65 2.562a3.981 3.981 0 0 0-1.646 4.604l.387.78a.5.5 0 0 0 .518.252H7.1a.5.5 0 0 1 .49.618 3.983 3.983 0 0 0 5.285 4.207A4.5 4.5 0 0 1 9.5 11.5zm-1.2-2.165c.683 0 1.316-.16 1.857-.442a4.48 4.48 0 0 0 1.266-1.027c.195-.235.293-.49.293-.729a.5.5 0 0 0-.451-.452.516.516 0 0 0-.451.293c-.07.169-.158.317-.268.454a2.481 2.481 0 0 1-1.571.742c-.28 0-.544-.059-.78-.17a.5.5 0 0 0-.657.279l-.387.78a3.98 3.98 0 0 0-.294.645.5.5 0 0 0 .232.619z"/>
                                                <path d="M7.5 9.5a.5.5 0 0 1 .39.181l.835.958a.5.5 0 0 0 .72-.059l.155-.21.013-.018a2.982 2.982 0 0 0-.134-.165A2.48 2.48 0 0 1 7.5 9.5z"/>
                                                <path d="M5.5 5.5c0-.279-.223-.5-.5-.5s-.5.221-.5.5.223.5.5.5.5-.221.5-.5zM7 5c-.279 0-.5.221-.5.5s.221.5.5.5.5-.221.5-.5S7.279 5 7 5zM8.5 5.5c0-.279-.221-.5-.5-.5s-.5.221-.5.5.223.5.5.5.5-.221.5-.5z"/>
                                                <path d="M6.5 5.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0z"/>
                                            </svg>
                                        </span>
                                        <span>${item.replyCount}</span>
                                    </div>
                                </div>
                            </div>
                        </li>
                    `;
                });
                document.querySelector(target).innerHTML = content;
            })
            .catch(error => console.error('Fetch error:', error));
    }

    var tabLinks = document.querySelectorAll('#myTab a');
    tabLinks.forEach(function(link) {
        link.addEventListener('shown.bs.tab', function(e) {
            var sortType = e.target.getAttribute("href").substring(1); // get tab id
            var target = `#${sortType}-content`; // find corresponding content id
            loadContent(sortType, target);
        });
    });

    // Load recent content by default
    loadContent('recent', '#recent-content');
});
